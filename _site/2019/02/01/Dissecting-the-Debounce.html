<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Build a Debounce function in JavaScript from scratch</title>
        <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
        integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
        crossorigin="anonymous"
    />

        <link rel="stylesheet" href="/assets/css/styles.css" />
    </head>

    <body>
          <section class="header">
    <div class="container">
        <a href="/">
            <div class="logo">
                <h1>&lt;iCodingClub/&gt;</h1>
            </div>
        </a>
    </div>
</section>

          <main>
            <section class="post bg-light">
    <div class="showcase post-banner bg-primary">
        <div class="container">
            <h1>Build a Debounce function in JavaScript from scratch</h1>
            <div class="bio">
                <img src="/assets/images/praveen.png" alt="" />
                <div class="info">
                    <span class="author">Praveen Singh</span>
                    <span class="date">01 Feb 2019</span>
                </div>
            </div>
        </div>
    </div>
    <div class="container grid">
        <div class="social">
    <a target="_blank" href="https://www.youtube.com/channel/UCpWyMAAKdvAUs6nSuelIgOA"><i class="fab fa-youtube fa-2x"></i></a>
    <a target="_blank" href="https://github.com/icodingclub"><i class="fab fa-github fa-2x"></i></a>
    <a target="_blank" href="https://twitter.com/i_praveensingh"><i class="fab fa-twitter fa-2x"></i></a>
</div>

        <article><h1 id="what-is-a-debounceanyway">What is a Debounce anyway?</h1>
<p>Debounce is a pattern to limit the rate at which function can fire. It returns a function, which can only be triggered when there is a user-provided delay in its invocations. If the function is getting triggered continuously, without the delay, it will not be called.</p>

<h2 id="advantages">Advantages</h2>
<ol>
  <li>Improve the performance by regulating the rate at which a function can be triggered.</li>
  <li>Make your code more meaningful, by calling the handler only when we need for it.</li>
</ol>

<h2 id="conceptual-diagram">Conceptual Diagram</h2>
<p><img src="/assets/post-images/debounce-architecure.png" alt="" /></p>

<h2 id="case-study-google-autocomplete-suggestions">Case Study - Google autocomplete suggestions</h2>

<p><img src="/assets/post-images/debounce-google.png" alt="" /></p>

<p>Google search is an interesting case of debounce pattern. If you are designing this page, you may want to consider the following</p>

<ol>
  <li>On every meaning full keyword, we want to provide autocomplete suggestions to the user.</li>
  <li>Providing suggestions too early, maybe at every keypress, would be meaningless. Also, it will put unnecessary load on the server.</li>
  <li>Providing it too late would defeat the purpose of autocomplete suggestions.</li>
</ol>

<p>Debounce is a standard pattern to solve this kind of problem.</p>

<h2 id="step-by-step-guide-for-building-a-debounce-function">Step by step guide for building a Debounce function.</h2>

<h3 id="step-1-delay-the-functioncall">Step 1: Delay the function call.</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cm">/*
 * DEBOUNCE
 */</span>
<span class="kd">function</span> <span class="nx">debounce</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>
<span class="cm">/*
 * TEST
 */</span>
<span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="kd">function</span> <span class="nx">timer</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Hello Debounce!</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">logMsg</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">msg</span><span class="p">}</span><span class="s2"> Time: </span><span class="p">${</span><span class="nx">timer</span><span class="p">()}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">smartLogMsg</span> <span class="o">=</span> <span class="nx">debounce</span><span class="p">(</span><span class="nx">logMsg</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>
<span class="nx">smartLogMsg</span><span class="p">();</span> <span class="c1">// will be called at 400+ ms.</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">smartLogMsg</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span> <span class="c1">// will be called at 700+ ms.</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">smartLogMsg</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span> <span class="c1">// will be called at 1200+ ms.</span>
</code></pre></div></div>

<p>Output:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">Hello Debounce! Time: 402.9799999552779
Hello Debounce! Time: 705.5549999931827
Hello Debounce! Time: 1200.894999958109
</span></code></pre></div></div>

<h2 id="step-2-limit-the-number-of-functioncalls">Step 2: Limit the number of function calls.</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 * DEBOUNCE
 */</span>
<span class="kd">function</span> <span class="nx">debounce</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">timeout</span><span class="p">;</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Clear the timeout if it get called before the wait period.</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
    <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/*
 * TEST
 */</span>
<span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="kd">function</span> <span class="nx">timer</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Hello Debounce!</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">logMsg</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">msg</span><span class="p">}</span><span class="s2"> Time: </span><span class="p">${</span><span class="nx">timer</span><span class="p">()}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">smartLogMsg</span> <span class="o">=</span> <span class="nx">debounce</span><span class="p">(</span><span class="nx">logMsg</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>
<span class="nx">smartLogMsg</span><span class="p">();</span> <span class="c1">// will be called at 400+ ms.</span>
<span class="c1">// will be called at 700+ ms, hence cancel the previous.</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">smartLogMsg</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
<span class="c1">// will be called at 1200+ ms, will log normally</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">smartLogMsg</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>

</code></pre></div></div>

<p>Output:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">Hello Debounce! Time: 705.0699999999779 
Hello Debounce! Time: 1200.7099999991624 

</span></code></pre></div></div>

<p>At this point, our debounce function is half complete and working for a few happy scenarios.</p>

<p>To fix things further, and to understand the value of it, we have to add a little bit of complexity now.
Let’s build a small App with following features</p>

<ol>
  <li>Take user input.</li>
  <li>Put through the debounce.</li>
  <li>Use a “fake” XHR call, which pretends that it’s processing the data on the server.</li>
  <li>Put back the “processed text” on the view, at a delayed rate.</li>
</ol>

<h1 id="starting-code">Starting code:</h1>
<p>Let’s use below code as starting point
<script async="" src="//jsfiddle.net/ipraveen/f9am6xeo/embed/html/"></script></p>

<p>If you run the code, use below fiddle, you will see that we are getting output but all are just undefined.</p>

<p>Let’s use below fiddle as starting point</p>

<script async="" src="//jsfiddle.net/ipraveen/f9am6xeo/embed/result/"></script>

<h3 id="whats-wrong-here">What’s wrong here?</h3>
<p>well, everything which can go wrong with this. We are losing the context. Let’s try to fix that.</p>

<h2 id="step-3-fix-thecontext">Step 3: Fix the context</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">debounce</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">timeout</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span> <span class="c1">// Preserving the context</span>
        <span class="kd">const</span> <span class="nx">executor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">timeout</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span> <span class="c1">// Calling function with context</span>
        <span class="p">};</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
        <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">executor</span><span class="p">,</span> <span class="nx">wait</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now, if you replace the <code class="language-plaintext highlighter-rouge">debounce</code> function in fiddle, you will see following output like below for input <code class="language-plaintext highlighter-rouge">abc a</code>.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">XHR with payload: abc
XHR with payload: abc
XHR with payload: abc a
</span></code></pre></div></div>

<p>Hurray!
No no….not so fast!….one last thing is pending. Can you see something odd in below section of code</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="kd">function</span> <span class="nx">handleInput</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">doXhr</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">`&lt;li&gt;</span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">&lt;/li&gt;`</span><span class="p">));</span>
 <span class="p">}</span>
<span class="p">...</span>

</code></pre></div></div>
<p>Well, we are using <code class="language-plaintext highlighter-rouge">this.value</code> to get the entered text; nothing wrong in it, it’s just we can also use <code class="language-plaintext highlighter-rouge">event.target.value</code> instead of that. let’s do the change and see the output.</p>

<h3 id="try-eventtargetvalue">Try <code class="language-plaintext highlighter-rouge">event.target.value</code></h3>

<p>Changes:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="kd">function</span> <span class="nx">handleInput</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">inputData</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="nx">doXhr</span><span class="p">(</span><span class="nx">inputData</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">`&lt;li&gt;</span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">&lt;/li&gt;`</span><span class="p">));</span>
      <span class="p">}</span>
<span class="p">...</span>
</code></pre></div></div>
<p>and when we run the code, disappointment is there on console</p>

<blockquote>
  <p>Uncaught TypeError: Cannot read property ‘target’ of undefined”</p>
</blockquote>

<p>Why?…point is, we are not mapping the argument passed to the function properly. Let’s fix that.</p>

<h2 id="step-4-fix-the-function-arguments">Step 4: Fix the function arguments</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">debounce</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">timeout</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">executor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">timeout</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">};</span>
<span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
        <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">executor</span><span class="p">,</span> <span class="nx">wait</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>

</code></pre></div></div>
<p>Now if you run the app, it will work like a charm, try below fiddle now.</p>

<h1 id="final-application">Final Application.</h1>

<h2 id="debounce-function">Debounce function</h2>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">debounce</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">timeout</span><span class="p">;</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
          <span class="kd">const</span> <span class="nx">executor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">timeout</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
          <span class="p">};</span>

          <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
          <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">executor</span><span class="p">,</span> <span class="nx">wait</span><span class="p">);</span>
        <span class="p">};</span>
      <span class="p">}</span>

</code></pre></div></div>

<h2 id="final-fiddle">Final Fiddle</h2>
<script async="" src="//jsfiddle.net/ipraveen/bhjd7cx5/embed/result/"></script>

<h2 id="final-fiddle-code">Final Fiddle Code</h2>

<script async="" src="//jsfiddle.net/ipraveen/bhjd7cx5/embed/html/"></script>

<p>Thank You!
That’s all folk! let me know in the comment section if this article helped you.</p>
</article>
    </div>
</section>

          </main>
        <footer class="footer bg-dark py-2">
    <div class="container grid">
        <div>
            <p>iCodingClub Copyright &copy; 2020</p>
        </div>
        <div class="social">
    <a target="_blank" href="https://www.youtube.com/channel/UCpWyMAAKdvAUs6nSuelIgOA"><i class="fab fa-youtube fa-2x"></i></a>
    <a target="_blank" href="https://github.com/icodingclub"><i class="fab fa-github fa-2x"></i></a>
    <a target="_blank" href="https://twitter.com/i_praveensingh"><i class="fab fa-twitter fa-2x"></i></a>
</div>

    </div>
</footer>

      </div>
    </body>
</html>
